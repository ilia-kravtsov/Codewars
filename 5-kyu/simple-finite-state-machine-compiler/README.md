<h2><a href=https://www.codewars.com/kata/59923f1301726f5430000059/train/javascript target="_blank">Simple Finite State Machine Compiler</a></h2><h3>5 kyu</h3><p>A <a href="https://en.wikipedia.org/wiki/Finite-state_machine" data-turbolinks="false" target="_blank">Finite State Machine</a> (FSM) is an abstract machine that can be in exactly one of a finite number of states at any given time. Simple examples are:</p><ul><li>vending machines, which dispense products when the proper combination of coins is deposited;</li><li>elevators, whose sequence of stops is determined by the floors requested by riders;</li><li>traffic lights, which change sequence when cars are waiting;</li><li>combination locks, which require the input of combination numbers in the proper order.</li></ul><p>In this Kata we are going to design our very own basic FSM <code>class</code> that takes in a <code>string</code> of <code>instructions</code></p><p><code>instructions</code> is a string input with the following format:</p><pre><code>first; next_if_input_0, next_if_input_1; output\nsecond; next_if_input_0, next_if_input_1; output\nthird; next_if_input_0, next_if_input_1; output</code></pre><p>A basic example would be:</p><pre style="display: none;"><code class="language-python"><span class="cm-variable">instructions</span> <span class="cm-operator">=</span> \<span class="cm-string">'''S1; S1, S2; 9</span><span class="cm-string">S2; S1, S3; 10</span><span class="cm-string">S3; S4, S3; 8</span><span class="cm-string">S4; S4, S1; 0'''</span></code></pre><pre style="display: none;"><code class="language-c"><span class="cm-type">char</span> <span class="cm-variable">instructions</span>[] <span class="cm-operator">=</span> <span class="cm-string">"S1; S1, S2; 9\n"</span>                      <span class="cm-string">"S2; S1, S3; 10\n"</span>                      <span class="cm-string">"S3; S4, S3; 8\n"</span>                      <span class="cm-string">"S4; S4, S1; 0"</span>;</code></pre><pre><code class="language-javascript"><span class="cm-keyword">const</span> <span class="cm-def">instructions</span> <span class="cm-operator">=</span> (  <span class="cm-string">'S1; S1, S2; 9\n'</span> <span class="cm-operator">+</span>  <span class="cm-string">'S2; S1, S3; 10\n'</span><span class="cm-operator">+</span>  <span class="cm-string">'S3; S4, S3; 8\n'</span> <span class="cm-operator">+</span>  <span class="cm-string">'S4; S4, S1; 0'</span> )</code></pre><pre style="display: none;"><code class="language-julia"><span class="cm-variable">instructions</span> <span class="cm-operator">=</span> <span class="cm-string">"""</span><span class="cm-string">S1; S1, S2; 9</span><span class="cm-string">S2; S1, S3; 10</span><span class="cm-string">S3; S4, S3; 8</span><span class="cm-string">S4; S4, S1; 0</span><span class="cm-string">"""</span></code></pre><pre style="display: none;"><code class="language-java"><span class="cm-type">String</span> <span class="cm-variable">instructions</span> <span class="cm-operator">=</span> <span class="cm-string">"S1; S1, S2; 9\n"</span> <span class="cm-operator">+</span>                      <span class="cm-string">"S2; S1, S3; 10\n"</span> <span class="cm-operator">+</span>                      <span class="cm-string">"S3; S4, S3; 8\n"</span> <span class="cm-operator">+</span>                      <span class="cm-string">"S4; S4, S1; 0\n"</span>;</code></pre><p>Where each line in the string describes a state in the FSM.Given in the example, if the current state was <code>S1</code>, if the <code>input is 0</code> it would loop back to itself: <code>S1</code> and if the <code>input is 1</code> it would go to <code>S2</code> </p><p>The instructions are compiled into the <code>FSM</code> class, then the <code>runFSM()</code> function will be called to simulate the compiled FSM.</p><p>Example:</p><pre style="display: none;"><code class="language-python"><span class="cm-comment"># run_fsm takes in two arguments:</span><span class="cm-variable">start</span> <span class="cm-operator">=</span> <span class="cm-string">'S1'</span><span class="cm-comment"># where start is the name of the state that it starts from</span><span class="cm-variable">sequence</span> <span class="cm-operator">=</span> [<span class="cm-number">0</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>]<span class="cm-comment"># where sequence is a list of inputs</span><span class="cm-comment"># inputs are only 1 or 0 (1 input variable) </span><span class="cm-comment"># to keep it simple with this Kata</span><span class="cm-variable">final_state</span>, <span class="cm-variable">final_state_value</span>, <span class="cm-variable">path</span> <span class="cm-operator">=</span> <span class="cm-variable">run_fsm</span>(<span class="cm-variable">start</span>, <span class="cm-variable">sequence</span>)<span class="cm-comment"># run_fsm should return a tuple as:</span><span class="cm-variable">final_state</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">name</span> <span class="cm-variable">of</span> <span class="cm-variable">final</span> <span class="cm-variable">state</span><span class="cm-variable">final_state_value</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">integer</span> <span class="cm-variable">value</span> <span class="cm-variable">of</span> <span class="cm-variable">state</span> <span class="cm-variable">output</span><span class="cm-variable">path</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">list</span> <span class="cm-variable">of</span> <span class="cm-variable">states</span> <span class="cm-variable">the</span> <span class="cm-variable">FSM</span> <span class="cm-variable">sequence</span> <span class="cm-variable">went</span> <span class="cm-variable">through</span></code></pre><pre style="display: none;"><code class="language-c"><span class="cm-variable">Fsm</span> <span class="cm-operator">*</span><span class="cm-variable">fsm</span> <span class="cm-operator">=</span> <span class="cm-variable">compile</span>(<span class="cm-variable">instructions</span>);<span class="cm-keyword">const</span> <span class="cm-type">char</span> <span class="cm-type">*</span><span class="cm-variable">final_state</span>;<span class="cm-keyword">const</span> <span class="cm-type">char</span> <span class="cm-type">*</span><span class="cm-variable">path</span>[<span class="cm-number">6</span>];<span class="cm-type">int</span> <span class="cm-variable">final_state_value</span> <span class="cm-operator">=</span> <span class="cm-variable">run_fsm</span>(  <span class="cm-variable">fsm</span>,  <span class="cm-string">"S1"</span>,                     <span class="cm-comment">// name of the initial state</span>  (<span class="cm-builtin">_Bool</span>[]){<span class="cm-number">0</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>}, <span class="cm-comment">// input</span>  <span class="cm-number">5</span>,                        <span class="cm-comment">// input length</span>  <span class="cm-operator">&amp;</span><span class="cm-variable">final_state</span>,             <span class="cm-comment">// returned final state</span>  <span class="cm-operator">&amp;</span><span class="cm-variable">path</span>                     <span class="cm-comment">// returned path</span>); <span class="cm-comment">// returns the output from the final state</span></code></pre><pre><code class="language-javascript"><span class="cm-comment">// runFSM takes two arguments:</span><span class="cm-variable">start</span> <span class="cm-operator">=</span> <span class="cm-string">'S1'</span><span class="cm-comment">// where start is the name of the state that it starts from</span><span class="cm-variable">sequence</span> <span class="cm-operator">=</span> [<span class="cm-number">0</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>]<span class="cm-comment">// where sequence is a list of inputs</span><span class="cm-comment">// inputs are only 1 or 0 (1 input variable) </span><span class="cm-comment">// to keep it simple with this Kata</span><span class="cm-comment">// Input / Output</span><span class="cm-variable">runFSM</span>(<span class="cm-variable">start</span>, <span class="cm-variable">sequence</span>)  <span class="cm-operator">--</span><span class="cm-variable">returns</span><span class="cm-operator">--&gt;</span>  [<span class="cm-variable">final_state</span>, <span class="cm-variable">final_state_value</span>, <span class="cm-variable">path</span>]<span class="cm-comment">// runFSM should return an array as:</span><span class="cm-variable">final_state</span>       <span class="cm-comment">//= name of final state</span><span class="cm-variable">final_state_value</span> <span class="cm-comment">//= integer value of state output</span><span class="cm-variable">path</span>              <span class="cm-comment">//= array of states the FSM sequence went through</span></code></pre><pre style="display: none;"><code class="language-julia"><span class="cm-comment"># run_fsm takes in three arguments:</span><span class="cm-comment"># fsm is your compiled FSM</span><span class="cm-variable">fsm</span> <span class="cm-operator">=</span> <span class="cm-variable">FSM</span>(<span class="cm-variable">instructions</span>)<span class="cm-comment"># start is the name of the state that it starts from</span><span class="cm-variable">start</span> <span class="cm-operator">=</span> <span class="cm-string">"S1</span><span class="cm-string">"</span><span class="cm-comment"># sequence is a list of inputs</span><span class="cm-variable">sequence</span> <span class="cm-operator">=</span> [<span class="cm-number">0</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>]<span class="cm-comment"># inputs are only 1 or 0 (1 input variable) </span><span class="cm-comment"># to keep it simple with this Kata</span><span class="cm-comment"># run_fsm should return a tuple as:</span><span class="cm-variable">final_state</span>, <span class="cm-variable">final_state_value</span>, <span class="cm-variable">path</span> <span class="cm-operator">=</span> <span class="cm-variable">run_fsm</span>(<span class="cm-variable">fsm</span>, <span class="cm-variable">start</span>, <span class="cm-variable">sequence</span>)<span class="cm-comment">#=</span><span class="cm-comment">  final_state =&gt; name of final state</span><span class="cm-comment">  final_state_value =&gt; integer value of state output</span><span class="cm-comment">  path =&gt; list of states the FSM sequence went through</span><span class="cm-comment">=#</span></code></pre><pre style="display: none;"><code class="language-java"><span class="cm-comment">// runFSM takes in two arguments:</span><span class="cm-comment">// fsm is your compiled FSM</span><span class="cm-variable">FSM</span> <span class="cm-variable">fsm</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">FSM</span>(<span class="cm-variable">instructions</span>);<span class="cm-comment">// start is the name of the state that it starts from</span><span class="cm-type">String</span> <span class="cm-variable">start</span> <span class="cm-operator">=</span> <span class="cm-string">"S1"</span>;<span class="cm-comment">// sequence is a list of inputs</span><span class="cm-type">int</span>[] <span class="cm-variable">sequence</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-type">int</span>[]{<span class="cm-number">0</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>};<span class="cm-comment">// inputs are only 1 or 0 (1 input variable) </span><span class="cm-comment">// to keep it simple with this Kata</span><span class="cm-comment">// runFSM should return a Result as:</span><span class="cm-variable">Result</span> <span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-variable">fsm</span>.<span class="cm-variable">runFSM</span>(<span class="cm-variable">start</span>, <span class="cm-variable">sequence</span>);<span class="cm-comment">// result.finalState =&gt; name of final state</span><span class="cm-comment">// result.output =&gt; integer value of state output</span><span class="cm-comment">// result.path =&gt; array of states the FSM sequence went through</span></code></pre><p>From the given example, when <code>run_fsm</code> is executed the following should proceed below</p><pre><code>instructions:S1; S1, S2; 9S2; S1, S3; 10S3; S4, S3; 8S4; S4, S1; 0start: S1sequence: 0, 1, 1, 0, 1input 0: S1-&gt;S1input 1: S1-&gt;S2input 1: S2-&gt;S3input 0: S3-&gt;S4input 1: S4-&gt;S1final state: S1output: 9</code></pre><p>In this Kata are many FSM examples in real life described in:<a href="https://en.wikipedia.org/wiki/Finite-state_machine" data-turbolinks="false" target="_blank">https://en.wikipedia.org/wiki/Finite-state_machine</a></p><p>Good Luck!</p>