<h2><a href=https://www.codewars.com/kata/52793ed3fdb8e19406000c72/train/javascript target="_blank">Monads:  The Maybe Monad</a></h2><h3>5 kyu</h3><h1 id="monads">Monads</h1><p>There are <a href="http://mvanier.livejournal.com/3917.html" data-turbolinks="false" target="_blank">dozens</a> and <a href="http://blog.leahhanson.us/a-simple-monad-tutorial.html" data-turbolinks="false" target="_blank">dozens</a> of <a href="http://en.wikipedia.org/wiki/Monad_%28functional_programming%29" data-turbolinks="false" target="_blank">monad</a> <a href="http://www.haskell.org/haskellwiki/Monad_tutorials_timeline" data-turbolinks="false" target="_blank">tutorials</a> and <a href="https://www.google.com/search?q=monads+explained" data-turbolinks="false" target="_blank">explanations</a> online.</p><p>I find the <a href="http://en.wikipedia.org/wiki/Monad_%28functional_programming%29#The_Maybe_monad" data-turbolinks="false" target="_blank">Maybe</a> monad to be the easiest one to wrap my head around.  Thus, it is the first in what may be a series of katas about monads.</p><p>Every monad must support two operations:</p><ul><li><code>return</code> or <code>unit</code> which takes a value and wraps it in whatever container the monad needs it to be wrapped in</li><li><code>bind</code> (called <code>&gt;&gt;=</code> in Haskell) which takes a function and returns a function.</li></ul><p>The input function to <code>bind</code> is a function that takes a value (not in the monad) as an argument and returns a value in the monad.The output function from <code>bind</code> is a function that takes a value in the monad and returns a value in the monad.</p><p>Note:  Technically, the input function can take a value not in the monad to a value in any monad and <code>bind</code> would return a function that takes a value in this monad and returns a value in whatever monad the input function returned a value in.  It is hard to really get the benefits of doing that in a weakly-typed language like Coffeescript so for this kata there will only be one monad.</p><p>There are <a href="http://en.wikipedia.org/wiki/Monad_%28functional_programming%29#Monad_laws" data-turbolinks="false" target="_blank">some laws</a> that dictate how <code>unit</code> and <code>bind</code> must compose.  Here is what the monad laws look like in Coffeescript or Javascript (where <code>f</code> and <code>g</code> are functions that take a value argument and return a monad value):</p><pre><code class="language-javascript"><span class="cm-variable">bind</span>(<span class="cm-variable">f</span>)(<span class="cm-variable">unit</span>(<span class="cm-variable">x</span>)) <span class="cm-operator">===</span> <span class="cm-variable">f</span>(<span class="cm-variable">x</span>)                            <span class="cm-comment">// for any value x  (left identity)</span><span class="cm-variable">bind</span>(<span class="cm-variable">unit</span>)(<span class="cm-variable">x</span>) <span class="cm-operator">===</span> <span class="cm-variable">x</span>                                  <span class="cm-comment">// for any value x  (right identity)</span><span class="cm-variable">bind</span>(<span class="cm-variable">g</span>)(<span class="cm-variable">bind</span>(<span class="cm-variable">f</span>)(<span class="cm-variable">m</span>)) <span class="cm-operator">===</span>  <span class="cm-variable">bind</span>( <span class="cm-keyword">function</span> (<span class="cm-def">x</span>) { <span class="cm-keyword">return</span> <span class="cm-variable">bind</span>(<span class="cm-variable">g</span>)(<span class="cm-variable">f</span>(<span class="cm-variable-2">x</span>)); } )(<span class="cm-variable">m</span>)  <span class="cm-comment">// for any m in the monad  (associativity)</span></code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-punctuation">(</span><span class="cm-punctuation">(</span><span class="cm-variable">bind</span> <span class="cm-variable">f</span><span class="cm-punctuation">)</span> <span class="cm-punctuation">(</span><span class="cm-variable">unit</span> <span class="cm-variable">x</span><span class="cm-punctuation">)</span><span class="cm-punctuation">)</span> <span class="cm-operator">is</span> <span class="cm-punctuation">(</span><span class="cm-variable">f</span> <span class="cm-variable">x</span><span class="cm-punctuation">)</span>                                    <span class="cm-comment"># for any value x  (left identity)</span><span class="cm-punctuation">(</span><span class="cm-punctuation">(</span><span class="cm-variable">bind</span> <span class="cm-variable">unit</span><span class="cm-punctuation">)</span> <span class="cm-variable">x</span><span class="cm-punctuation">)</span> <span class="cm-operator">is</span> <span class="cm-variable">x</span>                                            <span class="cm-comment"># for any value x  (right identity)</span><span class="cm-punctuation">(</span><span class="cm-punctuation">(</span><span class="cm-variable">bind</span> <span class="cm-variable">g</span><span class="cm-punctuation">)</span> <span class="cm-punctuation">(</span><span class="cm-punctuation">(</span><span class="cm-variable">bind</span> <span class="cm-variable">f</span><span class="cm-punctuation">)</span> <span class="cm-variable">m</span><span class="cm-punctuation">)</span><span class="cm-punctuation">)</span> <span class="cm-operator">is</span> <span class="cm-punctuation">(</span><span class="cm-punctuation">(</span><span class="cm-variable">bind</span> <span class="cm-punctuation">(</span><span class="cm-variable">x</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-punctuation">(</span><span class="cm-punctuation">(</span><span class="cm-variable">bind</span> <span class="cm-variable">g</span><span class="cm-punctuation">)</span> <span class="cm-punctuation">(</span><span class="cm-variable">f</span> <span class="cm-variable">x</span><span class="cm-punctuation">)</span><span class="cm-punctuation">)</span><span class="cm-punctuation">)</span> <span class="cm-variable">m</span><span class="cm-punctuation">)</span>   <span class="cm-comment"># for any m in the monad  (associativity)</span></code></pre><p>Sorting all of that out is tough.  Remember that <code>bind</code> returns a function that takes monad values to monad values.  For example, the last line asserts that both of the following functions always return the same thing as long as <code>m</code> is a valid monad value, <code>f</code> is a function from values to values in the monad, and <code>g</code> is a function from values to values in the monad:</p><pre><code class="language-javascript"><span class="cm-keyword">function</span> <span class="cm-def">lhs</span>(<span class="cm-def">m</span>,<span class="cm-def">f</span>,<span class="cm-def">g</span>) {  <span class="cm-keyword">var</span> <span class="cm-def">bg</span> <span class="cm-operator">=</span> <span class="cm-variable">bind</span>(<span class="cm-variable-2">g</span>);  <span class="cm-keyword">var</span> <span class="cm-def">bf</span> <span class="cm-operator">=</span> <span class="cm-variable">bind</span>(<span class="cm-variable-2">f</span>);  <span class="cm-keyword">return</span> <span class="cm-variable-2">bg</span>(<span class="cm-variable-2">bf</span>(<span class="cm-variable-2">m</span>));}<span class="cm-keyword">function</span> <span class="cm-def">rhs</span>(<span class="cm-def">m</span>,<span class="cm-def">f</span>,<span class="cm-def">g</span>) <span class="cm-operator">-</span><span class="cm-operator">&gt;</span>  <span class="cm-keyword">var</span> <span class="cm-variable-2">bg</span> <span class="cm-operator">=</span> <span class="cm-variable">bind</span>(<span class="cm-variable">g</span>);  <span class="cm-keyword">var</span> <span class="cm-def">ba</span> <span class="cm-operator">=</span> <span class="cm-variable">bind</span>( <span class="cm-keyword">function</span> (<span class="cm-def">x</span>) { <span class="cm-keyword">return</span> <span class="cm-variable-2">bg</span>(<span class="cm-variable">f</span>(<span class="cm-variable-2">x</span>)); } );  <span class="cm-keyword">return</span> <span class="cm-variable">ba</span>(<span class="cm-variable">m</span>);}</code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-variable">lhs</span> <span class="cm-punctuation">=</span> <span class="cm-punctuation">(</span><span class="cm-variable">m</span><span class="cm-punctuation">,</span><span class="cm-variable">f</span><span class="cm-punctuation">,</span><span class="cm-variable">g</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span>  <span class="cm-variable">bg</span> <span class="cm-punctuation">=</span> <span class="cm-variable">bind</span> <span class="cm-variable">g</span>  <span class="cm-variable">bf</span> <span class="cm-punctuation">=</span> <span class="cm-variable">bind</span> <span class="cm-variable">f</span>  <span class="cm-variable">bg</span> <span class="cm-punctuation">(</span><span class="cm-variable">bf</span> <span class="cm-variable">m</span><span class="cm-punctuation">)</span><span class="cm-variable">rhs</span> <span class="cm-punctuation">=</span> <span class="cm-punctuation">(</span><span class="cm-variable">m</span><span class="cm-punctuation">,</span><span class="cm-variable">f</span><span class="cm-punctuation">,</span><span class="cm-variable">g</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span>  <span class="cm-variable">bg</span> <span class="cm-punctuation">=</span> <span class="cm-variable">bind</span> <span class="cm-variable">g</span>  <span class="cm-variable">ba</span> <span class="cm-punctuation">=</span> <span class="cm-variable">bind</span> <span class="cm-punctuation">(</span><span class="cm-variable">x</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">bg</span> <span class="cm-punctuation">(</span><span class="cm-variable">f</span> <span class="cm-variable">x</span><span class="cm-punctuation">)</span>  <span class="cm-variable">ba</span> <span class="cm-variable">m</span></code></pre><p>You probably don't need to completely understand the above to succeed in this kata.</p><h2 id="other-monad-operations">Other monad operations</h2><p>For convenience, monads often support a <code>lift</code> function which takes a function from values to values and returns a function from values to the monad values.</p><p>Our monads will also support a <code>do</code> function which takes a monad value and an arbitrary number of functions (which take a value as an argument and return a monad value).  The <code>do</code> function binds the first function with the monad and passes it the argument value.  It then uses the return value of that first bound function as the input for the next function, etc.  It finally returns the last result.  So, for example:  <code>do(m, f, g, h)</code> should be equivalent to:</p><pre><code class="language-javascript"><span class="cm-keyword">var</span> <span class="cm-def">bf</span> <span class="cm-operator">=</span> <span class="cm-variable">bind</span>(<span class="cm-variable">f</span>);<span class="cm-keyword">var</span> <span class="cm-def">bg</span> <span class="cm-operator">=</span> <span class="cm-variable">bind</span>(<span class="cm-variable">g</span>);<span class="cm-keyword">var</span> <span class="cm-def">bh</span> <span class="cm-operator">=</span> <span class="cm-variable">bind</span>(<span class="cm-variable">h</span>);<span class="cm-variable">bh</span>(<span class="cm-variable">bg</span>(<span class="cm-variable">bf</span>(<span class="cm-variable">m</span>)));</code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-variable">bf</span> <span class="cm-punctuation">=</span> <span class="cm-variable">bind</span> <span class="cm-variable">f</span><span class="cm-variable">bg</span> <span class="cm-punctuation">=</span> <span class="cm-variable">bind</span> <span class="cm-variable">g</span><span class="cm-variable">bh</span> <span class="cm-punctuation">=</span> <span class="cm-variable">bind</span> <span class="cm-variable">h</span><span class="cm-variable">bh</span> <span class="cm-punctuation">(</span><span class="cm-variable">bg</span> <span class="cm-punctuation">(</span><span class="cm-variable">bf</span> <span class="cm-variable">m</span><span class="cm-punctuation">)</span><span class="cm-punctuation">)</span></code></pre><h2 id="the-maybe-monad">The Maybe monad</h2><p>The <code>Maybe</code> monad has two types of values <code>Just x</code> and <code>Nothing</code> values.  These classes are already written here.</p><pre><code class="language-javascript"><span class="cm-keyword">function</span> <span class="cm-def">Just</span> (<span class="cm-def">x</span>) {  <span class="cm-keyword">this</span>.<span class="cm-property">toString</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span> () { <span class="cm-keyword">return</span> <span class="cm-string">"Just "</span> <span class="cm-operator">+</span> <span class="cm-variable-2">x</span>.<span class="cm-property">toString</span>(); };  <span class="cm-keyword">this</span>.<span class="cm-property">just</span> <span class="cm-operator">=</span> <span class="cm-variable-2">x</span>;  <span class="cm-variable">Object</span>.<span class="cm-property">freeze</span>(<span class="cm-keyword">this</span>);};<span class="cm-variable">Just</span>.<span class="cm-property">prototype</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Maybe</span>();<span class="cm-variable">Just</span>.<span class="cm-property">prototype</span>.<span class="cm-property">constructor</span> <span class="cm-operator">=</span> <span class="cm-variable">Just</span>;<span class="cm-keyword">function</span> <span class="cm-def">Nothing</span> () {  <span class="cm-keyword">this</span>.<span class="cm-property">toString</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span> () { <span class="cm-keyword">return</span> <span class="cm-string">"Nothing"</span>; };  <span class="cm-variable">Object</span>.<span class="cm-property">freeze</span>(<span class="cm-keyword">this</span>);};<span class="cm-variable">Nothing</span>.<span class="cm-property">prototype</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Maybe</span>();<span class="cm-variable">Nothing</span>.<span class="cm-property">prototype</span>.<span class="cm-property">constructor</span> <span class="cm-operator">=</span> <span class="cm-variable">Nothing</span>;</code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-keyword">class</span> <span class="cm-variable">Just</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Maybe</span>  <span class="cm-variable">constructor</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-property">@just</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span><span class="cm-dedent">  </span><span class="cm-variable">toString</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-string">"Just #{@just}"</span><span class="cm-keyword">class</span> <span class="cm-variable">Nothing</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Maybe</span>  <span class="cm-variable">constructor</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span><span class="cm-dedent">  </span><span class="cm-variable">toString</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-string">"Nothing"</span></code></pre><p>You need to fill in the class methods on the <code>Maybe</code> class:</p><pre><code class="language-javascript"><span class="cm-variable">Maybe</span>.<span class="cm-property">unit</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span> (<span class="cm-def">x</span>) { <span class="cm-meta">...</span> };<span class="cm-variable">Maybe</span>.<span class="cm-property">bind</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span> (<span class="cm-def">f</span>) { <span class="cm-meta">...</span> };<span class="cm-variable">Maybe</span>.<span class="cm-property">lift</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span> (<span class="cm-def">f</span>) { <span class="cm-meta">...</span> };<span class="cm-variable">Maybe</span>.<span class="cm-property">do</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span> (<span class="cm-def">m</span>,<span class="cm-def">fns</span>) { <span class="cm-meta">...</span> };</code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-keyword">class</span> <span class="cm-variable">Maybe</span>  <span class="cm-property">@unit</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-variable">x</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span><span class="cm-dedent">  </span><span class="cm-property">@bind</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-variable">f</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span><span class="cm-dedent">  </span><span class="cm-property">@lift</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-variable">f</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span><span class="cm-dedent">  </span><span class="cm-property">@do</span><span class="cm-punctuation">:</span> <span class="cm-punctuation">(</span><span class="cm-variable">m</span><span class="cm-punctuation">,</span> <span class="cm-variable">fns</span><span class="cm-punctuation">...</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span></code></pre><p>Here's a graphical depiction of how <code>@lift</code> and <code>@bind</code> are related:<img height="163" width="697" src="http://www.csh.rit.edu/~pat/lj/maybe-monad.png"></p><p>The <code>@unit</code> function should return a <code>Maybe</code> subclass instance which wraps the value <code>x</code>:</p><pre><code class="language-javascript"><span class="cm-variable">Maybe</span>.<span class="cm-property">unit</span>(<span class="cm-variable">x</span>) <span class="cm-keyword">instanceof</span> <span class="cm-def">Maybe</span>   <span class="cm-comment">// =&gt; true</span></code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-punctuation">(</span><span class="cm-variable">Maybe</span><span class="cm-punctuation">.</span><span class="cm-property">unit</span> <span class="cm-variable">x</span><span class="cm-punctuation">)</span> <span class="cm-operator">instanceof</span> <span class="cm-variable">Maybe</span>    <span class="cm-comment"># =&gt; true</span></code></pre><p>The <code>@bind</code> function should take the function <code>f</code> which has a single input argument value and returns a <code>Maybe</code> subclass instance.  The <code>@bind</code> function should return a new function which takes one <code>Maybe</code> subclass instance as an argument.  If the argument is <code>Just x</code>, then the returned function should return <code>(f x)</code>.  If the argument is <code>Nothing</code>, then the returned function should return <code>Nothing</code>.  If the argument is not a <code>Maybe</code> subclass instance, then the returned function should throw an error.</p><pre><code class="language-javascript"><span class="cm-keyword">function</span> <span class="cm-def">mDup</span>(<span class="cm-def">str</span>) {  <span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">Just</span>(<span class="cm-variable-2">str</span><span class="cm-operator">+</span><span class="cm-variable-2">str</span>);}<span class="cm-variable">mDup</span>(<span class="cm-string">"abc"</span>);           <span class="cm-comment">// =&gt; new Just("abcabc")</span><span class="cm-keyword">var</span> <span class="cm-def">bmDup</span> <span class="cm-operator">=</span> <span class="cm-variable">Maybe</span>.<span class="cm-property">bind</span>(<span class="cm-variable">mDup</span>);<span class="cm-variable">bmDup</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Nothing</span>)     <span class="cm-comment">// =&gt; new Nothing</span><span class="cm-variable">bmDup</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Just</span>(<span class="cm-string">"abc"</span>)) <span class="cm-comment">// =&gt; new Just("abcabc")</span></code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-variable">mDup</span> <span class="cm-punctuation">=</span> <span class="cm-punctuation">(</span><span class="cm-variable">str</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-keyword">new</span> <span class="cm-variable">Just</span> <span class="cm-punctuation">(</span><span class="cm-variable">str</span> <span class="cm-operator">+</span> <span class="cm-variable">str</span><span class="cm-punctuation">)</span><span class="cm-variable">mDup</span> <span class="cm-string">"abc"</span>     <span class="cm-comment"># =&gt; new Just "abcabc"</span><span class="cm-variable">bmDup</span> <span class="cm-punctuation">=</span> <span class="cm-variable">Maybe</span><span class="cm-punctuation">.</span><span class="cm-property">bind</span> <span class="cm-variable">mDup</span><span class="cm-variable">bmDup</span> <span class="cm-punctuation">(</span><span class="cm-keyword">new</span> <span class="cm-variable">Nothing</span><span class="cm-punctuation">)</span>      <span class="cm-comment"># =&gt; new Nothing</span><span class="cm-variable">bmDup</span> <span class="cm-punctuation">(</span><span class="cm-keyword">new</span> <span class="cm-variable">Just</span> <span class="cm-string">"abc"</span><span class="cm-punctuation">)</span>   <span class="cm-comment"># =&gt; new Just "abcabc"</span><span class="cm-variable">bmDup</span> <span class="cm-number">5</span>                  <span class="cm-comment"># throws an error</span></code></pre><p>The <code>@lift</code> function should take the function <code>f</code> which has a single input argument value and returns a value.  The <code>@lift</code> function should return a new function of a single argument <code>x</code>  that wraps the results of <code>(f x)</code> in a <code>Maybe</code> subclass instance.  If evaluation of <code>(f x)</code> throws an exception of any kind, then this function should return a <code>Nothing</code> instances, otherwise it should return a <code>Just</code> instance containing <code>(f x)</code>.</p><pre><code class="language-javascript"><span class="cm-keyword">function</span> <span class="cm-def">nonnegative</span>(<span class="cm-def">x</span>) {  <span class="cm-keyword">if</span> (<span class="cm-variable">isNaN</span>(<span class="cm-variable-2">x</span>) <span class="cm-operator">||</span> <span class="cm-number">0</span> <span class="cm-operator">&lt;=</span> <span class="cm-variable-2">x</span>) {    <span class="cm-keyword">return</span> <span class="cm-variable-2">x</span>;  } <span class="cm-keyword">else</span> {    <span class="cm-keyword">throw</span> <span class="cm-string">"Argument "</span> <span class="cm-operator">+</span> <span class="cm-variable-2">x</span> <span class="cm-operator">+</span> <span class="cm-string">" must be non-negative"</span>;  }}<span class="cm-keyword">var</span> <span class="cm-def">mNonnegative</span> <span class="cm-operator">=</span> <span class="cm-variable">Maybe</span>.<span class="cm-property">lift</span>(<span class="cm-variable">nonnegative</span>)<span class="cm-variable">mNonnegative</span>(<span class="cm-number">2</span>)           <span class="cm-comment">// =&gt; new Just 2</span><span class="cm-variable">mNonnegative</span>(<span class="cm-operator">-</span><span class="cm-number">1</span>)          <span class="cm-comment">// =&gt; new Nothing</span><span class="cm-variable">mNonnegative</span>(<span class="cm-atom">undefined</span>)   <span class="cm-comment">// =&gt; new Just undefined</span></code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-variable">nonnegative</span> <span class="cm-punctuation">=</span> <span class="cm-punctuation">(</span><span class="cm-variable">x</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-keyword">if</span> <span class="cm-variable">isNaN</span><span class="cm-punctuation">(</span><span class="cm-variable">x</span><span class="cm-punctuation">)</span> <span class="cm-operator">or</span> <span class="cm-number">0</span> <span class="cm-operator">&lt;=</span> <span class="cm-variable">x</span> <span class="cm-keyword">then</span> <span class="cm-variable">x</span> <span class="cm-keyword">else</span> <span class="cm-keyword">throw</span> <span class="cm-string">"Argument #{x} must be non-negative"</span><span class="cm-variable">mNonnegative</span> <span class="cm-punctuation">=</span> <span class="cm-variable">Maybe</span><span class="cm-punctuation">.</span><span class="cm-property">lift</span> <span class="cm-variable">nonnegative</span><span class="cm-punctuation">(</span><span class="cm-variable">mNonnegative</span> <span class="cm-number">2</span><span class="cm-punctuation">)</span>           <span class="cm-comment"># =&gt; new Just 2</span><span class="cm-punctuation">(</span><span class="cm-variable">mNonnegative</span> <span class="cm-number">-1</span><span class="cm-punctuation">)</span>          <span class="cm-comment"># =&gt; new Nothing</span><span class="cm-punctuation">(</span><span class="cm-variable">mNonnegative</span> <span class="cm-atom">undefined</span><span class="cm-punctuation">)</span>   <span class="cm-comment"># =&gt; new Just undefined</span></code></pre><p>The <code>@do</code> function should take a <code>Maybe</code> subclass instance <code>m</code> and a sequence of functions, bind each of the functions using <code>@bind</code>, call the first bound function, pass that value to the second bound function, etc. and return the final function's return value.</p><pre><code class="language-javascript"><span class="cm-keyword">var</span> <span class="cm-def">mDup</span> <span class="cm-operator">=</span> <span class="cm-variable">Maybe</span>.<span class="cm-property">lift</span>( <span class="cm-keyword">function</span> (<span class="cm-def">s</span>) { <span class="cm-keyword">return</span>  <span class="cm-variable-2">s</span><span class="cm-operator">+</span><span class="cm-variable-2">s</span>; } );<span class="cm-keyword">var</span> <span class="cm-def">mTrim</span> <span class="cm-operator">=</span> <span class="cm-variable">Maybe</span>.<span class="cm-property">lift</span>( <span class="cm-keyword">function</span> (<span class="cm-def">s</span>) { <span class="cm-keyword">return</span> <span class="cm-variable-2">s</span>.<span class="cm-property">replace</span>(<span class="cm-string-2">/\s+$/</span>, <span class="cm-string">''</span>); } );<span class="cm-variable">Maybe</span>.<span class="cm-property">do</span>( <span class="cm-variable">Maybe</span>.<span class="cm-property">unit</span>(<span class="cm-string">"abc "</span>), <span class="cm-variable">mDup</span>, <span class="cm-variable">mTrim</span>, <span class="cm-variable">mDup</span> )   <span class="cm-comment">// =&gt; new Just "abc abcabc abc"</span></code></pre><pre style="display: none;"><code class="language-coffeescript"><span class="cm-variable">mDup</span> <span class="cm-punctuation">=</span> <span class="cm-variable">Maybe</span><span class="cm-punctuation">.</span><span class="cm-property">lift</span> <span class="cm-punctuation">(</span><span class="cm-variable">s</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">s</span><span class="cm-operator">+</span><span class="cm-variable">s</span><span class="cm-variable">mTrim</span> <span class="cm-punctuation">=</span> <span class="cm-variable">Maybe</span><span class="cm-punctuation">.</span><span class="cm-property">lift</span> <span class="cm-punctuation">(</span><span class="cm-variable">s</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">s</span><span class="cm-punctuation">.</span><span class="cm-property">replace</span> <span class="cm-string-2">/\s+$/</span><span class="cm-punctuation">,</span> <span class="cm-string">''</span><span class="cm-variable">Maybe</span><span class="cm-punctuation">.</span><span class="cm-property">do</span> <span class="cm-punctuation">(</span><span class="cm-variable">Maybe</span><span class="cm-punctuation">.</span><span class="cm-property">unit</span> <span class="cm-string">"abc "</span><span class="cm-punctuation">)</span><span class="cm-punctuation">,</span> <span class="cm-variable">mDup</span><span class="cm-punctuation">,</span> <span class="cm-variable">mTrim</span><span class="cm-punctuation">,</span> <span class="cm-variable">mDup</span>   <span class="cm-comment"># =&gt; new Just "abc abcabc abc"</span></code></pre><h2 id="caveat">Caveat</h2><p>I feel that for the <code>Maybe</code> monad, the description above is almost telling you how exactly to write the functions.  As such, I haven't given you any sample tests.  My whole <code>Maybe</code> class is 14 lines long.  So, if you find yourself writing gobs of code, you're probably off track.</p>