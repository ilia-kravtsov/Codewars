<h2><a href=https://www.codewars.com/kata/5314ce58288b818ddc00006a/train/javascript target="_blank">Decorator Pattern</a></h2><h3>5 kyu</h3><h3 id="the-decorator-pattern-is-a-design-pattern-that-allows-behaviour-to-be-added-to-an-existing-objectfunction-dynamically-without-affecting-its-implementation">The <a href="http://en.wikipedia.org/wiki/Decorator_pattern" data-turbolinks="false" target="_blank">Decorator Pattern</a> is a design pattern that allows behaviour to be added to an existing object/function dynamically without affecting its implementation.</h3><p>This pattern is designed so that multiple decorators can be stacked on top of each other, each time adding a new functionality to the overridden function(s).</p><p>The decorator pattern is an alternative to subclassing. Subclassing adds behavior at compile time, and the change affects all instances of the original class; decorating can provide new behavior at run-time for individual objects/functions.</p><img style="background-color: #ddd" src="http://upload.wikimedia.org/wikipedia/commons/e/e9/Decorator_UML_class_diagram.svg"><hr><h3 id="motivation">Motivation:</h3><p>We will explain the utility of the decorator pattern with a simple example.</p><p>Suppose we have the <code>sum()</code> function:</p><pre><code class="language-javascript"><span class="cm-comment">//returns the sum of the arguments</span><span class="cm-keyword">function</span> <span class="cm-def">sum</span>() {  <span class="cm-keyword">return</span> <span class="cm-variable">Array</span>.<span class="cm-property">prototype</span>.<span class="cm-property">reduce</span>.<span class="cm-property">call</span>(<span class="cm-variable-2">arguments</span>, <span class="cm-keyword">function</span>(<span class="cm-def">sum</span>, <span class="cm-def">value</span>) {    <span class="cm-keyword">return</span> <span class="cm-variable-2">sum</span> <span class="cm-operator">+</span> <span class="cm-variable-2">value</span>;  }, <span class="cm-number">0</span>);}<span class="cm-variable">sum</span>(<span class="cm-number">1</span>, <span class="cm-number">4</span>, <span class="cm-number">8</span>, <span class="cm-number">9</span>) <span class="cm-comment">//22</span></code></pre><p>Now suppose we want to sum only the numbers are between 1 and 9. An intrusive and non-reusable solution could be:</p><pre><code class="language-javascript"><span class="cm-comment">//returns the sum of the arguments between 1 and 9</span><span class="cm-keyword">function</span> <span class="cm-def">sum</span>() {  <span class="cm-keyword">return</span> <span class="cm-variable">Array</span>.<span class="cm-property">prototype</span>.<span class="cm-property">reduce</span>.<span class="cm-property">call</span>(<span class="cm-variable-2">arguments</span>, <span class="cm-keyword">function</span>(<span class="cm-def">sum</span>, <span class="cm-def">value</span>) {    <span class="cm-keyword">if</span> (<span class="cm-variable-2">value</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">1</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">9</span>) {      <span class="cm-keyword">return</span> <span class="cm-variable-2">sum</span> <span class="cm-operator">+</span> <span class="cm-variable-2">value</span>;    } <span class="cm-keyword">else</span> {      <span class="cm-keyword">return</span> <span class="cm-variable-2">sum</span>;    }  }, <span class="cm-number">0</span>);}<span class="cm-variable">sum</span>(<span class="cm-number">1</span>, <span class="cm-number">9</span>, <span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">4</span>, <span class="cm-number">8</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>); <span class="cm-comment">// 22</span></code></pre><p>Although this solution is correct, it is not reusable because it is difficult to modify the minimum and maximum limits or add new functionality.</p><p>A better solution would be to define the <code>filter(min, max)</code> function:</p><pre><code class="language-javascript"><span class="cm-comment">//returns an array containing the numbers that are between min and max</span><span class="cm-comment">//the numbers are passed from third position</span><span class="cm-keyword">function</span> <span class="cm-def">filter</span>(<span class="cm-def">min</span>, <span class="cm-def">max</span>) {  <span class="cm-keyword">return</span> <span class="cm-variable">Array</span>.<span class="cm-property">prototype</span>.<span class="cm-property">slice</span>.<span class="cm-property">call</span>(<span class="cm-variable-2">arguments</span>, <span class="cm-number">2</span>).<span class="cm-property">filter</span>(<span class="cm-keyword">function</span>(<span class="cm-def">value</span>) {    <span class="cm-keyword">return</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">min</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&lt;=</span> <span class="cm-variable-2">max</span>;  });}<span class="cm-variable">filter</span>(<span class="cm-number">1</span>, <span class="cm-number">9</span>, <span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">4</span>, <span class="cm-number">8</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>); <span class="cm-comment">// [1, 4, 8, 9]</span></code></pre><p>Now we can call the <code>sum()</code> function like this:</p><pre><code class="language-javascript"><span class="cm-comment">//returns the sum of the arguments between 1 and 9</span><span class="cm-variable">sum</span>.<span class="cm-property">apply</span>(<span class="cm-atom">null</span>, <span class="cm-variable">filter</span>(<span class="cm-number">1</span>, <span class="cm-number">9</span>, <span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">4</span>, <span class="cm-number">8</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>)); <span class="cm-comment">//22</span></code></pre><p>This looks great. We have now achieved the same result without affecting the <code>sum()</code> function and we have an independent function, <code>filter(min, max)</code>, we can apply to other functions in addition to the <code>sum()</code> function.</p><p>For example:</p><pre><code class="language-javascript"><span class="cm-comment">//returns the multiplication of the arguments</span><span class="cm-keyword">function</span> <span class="cm-def">multiplication</span>() {  <span class="cm-keyword">return</span> <span class="cm-variable">Array</span>.<span class="cm-property">prototype</span>.<span class="cm-property">reduce</span>.<span class="cm-property">call</span>(<span class="cm-variable-2">arguments</span>, <span class="cm-keyword">function</span>(<span class="cm-def">product</span>, <span class="cm-def">value</span>) {    <span class="cm-keyword">return</span> <span class="cm-variable-2">product</span> <span class="cm-operator">*</span> <span class="cm-variable-2">value</span>;  }, <span class="cm-number">1</span>);}<span class="cm-variable">multiplication</span>.<span class="cm-property">apply</span>(<span class="cm-atom">null</span>, <span class="cm-variable">filter</span>(<span class="cm-number">1</span>, <span class="cm-number">9</span>, <span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">4</span>, <span class="cm-number">8</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>));  <span class="cm-comment">//288</span></code></pre><p>Now suppose we define the <code>noNumbersFilter()</code> function that removes those values that can not be added because they are not numeric:</p><pre><code class="language-javascript"><span class="cm-keyword">function</span> <span class="cm-def">filterNoNumbers</span>() {  <span class="cm-keyword">return</span> <span class="cm-variable">Array</span>.<span class="cm-property">prototype</span>.<span class="cm-property">filter</span>.<span class="cm-property">call</span>(<span class="cm-variable-2">arguments</span>, <span class="cm-keyword">function</span>(<span class="cm-def">value</span>) {    <span class="cm-keyword">return</span> <span class="cm-keyword">typeof</span> <span class="cm-variable-2">value</span> <span class="cm-operator">===</span> <span class="cm-string">'number'</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">value</span> <span class="cm-operator">===</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">value</span> <span class="cm-operator">!==</span> <span class="cm-variable">Number</span>.<span class="cm-property">POSITIVE_INFINITY</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">value</span> <span class="cm-operator">!==</span> <span class="cm-variable">Number</span>.<span class="cm-property">NEGATIVE_INFINITY</span>;  });}<span class="cm-variable">filterNoNumbers</span>(<span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-atom">NaN</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-string">"2"</span>, <span class="cm-number">4</span>, <span class="cm-number">8</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>); <span class="cm-comment">// [-3, 1, 0, 4, 8, 9, 12]</span></code></pre><p>We could do the same and apply the <code>filterNoNumbers()</code> function in this way:</p><pre><code class="language-javascript"><span class="cm-variable">sum</span>.<span class="cm-property">apply</span>(<span class="cm-atom">null</span>, <span class="cm-variable">filter</span>.<span class="cm-property">apply</span>(<span class="cm-atom">null</span>, [<span class="cm-number">1</span>, <span class="cm-number">9</span>].<span class="cm-property">concat</span>(<span class="cm-variable">filterNoNumbers</span>(<span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-atom">NaN</span>, <span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-string">"2"</span>, <span class="cm-number">4</span>, <span class="cm-number">8</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>)))); <span class="cm-comment">// 22</span></code></pre><p>Even if it works, it starts to be a challenge to do this without errors.</p><p>We can further complicate the problem if we want the result of the sum has to be rounded to two decimal digits. To do this, we define the <code>round(decimals)</code> function:</p><pre><code class="language-javascript"><span class="cm-keyword">function</span> <span class="cm-def">round</span>(<span class="cm-def">decimals</span>) {  <span class="cm-keyword">if</span> (<span class="cm-variable-2">arguments</span>.<span class="cm-property">length</span> <span class="cm-operator">===</span> <span class="cm-number">2</span>) {    <span class="cm-keyword">return</span> <span class="cm-variable-2">arguments</span>[<span class="cm-number">1</span>].<span class="cm-property">toFixed</span>(<span class="cm-variable-2">decimals</span>);  } <span class="cm-keyword">else</span> {    <span class="cm-keyword">return</span> <span class="cm-variable">Array</span>.<span class="cm-property">prototype</span>.<span class="cm-property">splice</span>.<span class="cm-property">call</span>(<span class="cm-variable-2">arguments</span>, <span class="cm-number">1</span>).<span class="cm-property">map</span>(<span class="cm-keyword">function</span>(<span class="cm-def">value</span>) {      <span class="cm-keyword">return</span> <span class="cm-variable-2">value</span>.<span class="cm-property">toFixed</span>(<span class="cm-variable-2">decimals</span>);    });  }}<span class="cm-variable">round</span>(<span class="cm-number">2</span>, <span class="cm-number">1</span>, <span class="cm-number">2.1</span>, <span class="cm-number">2.346</span>); <span class="cm-comment">// ["1.00", "2.10", "2.35"]</span><span class="cm-variable">round</span>(<span class="cm-number">2</span>, <span class="cm-number">1.3</span>); <span class="cm-comment">// "1.30"</span></code></pre><p>And we use it in this way:</p><pre><code class="language-javascript"><span class="cm-variable">round</span>.<span class="cm-property">apply</span>(<span class="cm-atom">null</span>, [<span class="cm-number">2</span>].<span class="cm-property">concat</span>(<span class="cm-variable">sum</span>.<span class="cm-property">apply</span>(<span class="cm-atom">null</span>, <span class="cm-variable">filter</span>.<span class="cm-property">apply</span>(<span class="cm-atom">null</span>, [<span class="cm-number">1</span>, <span class="cm-number">9</span>].<span class="cm-property">concat</span>(<span class="cm-variable">filterNoNumbers</span>(<span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-number">1.016</span>, <span class="cm-number">0</span>, <span class="cm-number">4</span>, <span class="cm-atom">NaN</span>, <span class="cm-number">8.041</span>, <span class="cm-string">'27'</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>)))))); <span class="cm-comment">// "22.06"</span></code></pre><h4 id="it-would-be-better-if-we-could-generalize-the-solution-this-is-where-the-decorator-pattern-comes-into-play">It would be better if we could generalize the solution. This is where the <strong>decorator pattern</strong> comes into play.</h4><hr><h3 id="work-to-do">Work to do:</h3><p>Your work is implement the <code>decorate(fn)</code> function. Note that this function takes the function to decorate. The <code>decorate(fn)</code> function can also receive the parameters passed to the decorator functions. See the example below.</p><p>When you call the <code>decorate(fn)</code> function, a decorated function will be returned. When this returned function is called, the function <code>fn()</code> passed in <code>decorate(fn)</code> will be called applying decorator functions.</p><p>The <code>Decorator(options)</code> function is already implemented. Note that the function receives an object with two attributes <code>before</code> and <code>after</code>. These attributes are the decorator functions which apply before and after calling the function passed in <code>decorate(fn)</code>, respectively. One or both may be null.</p><p>The way to use these functions are as follows:</p><pre><code class="language-javascript"><span class="cm-keyword">var</span> <span class="cm-def">filterDecorator</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Decorator</span>({  <span class="cm-property">before</span> : <span class="cm-variable">filter</span>});<span class="cm-keyword">var</span> <span class="cm-def">filterNoNumbersDecorator</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Decorator</span>({  <span class="cm-property">before</span> : <span class="cm-variable">filterNoNumbers</span>});<span class="cm-keyword">var</span> <span class="cm-def">roundDecorator</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Decorator</span>({  <span class="cm-property">after</span>: <span class="cm-variable">round</span>});<span class="cm-keyword">var</span> <span class="cm-def">decoratedSum</span> <span class="cm-operator">=</span> <span class="cm-variable">filterDecorator</span>.<span class="cm-property">decorate</span>(<span class="cm-variable">sum</span>, <span class="cm-number">1</span>, <span class="cm-number">9</span>); <span class="cm-comment">// 1 and 9 are the min and max parameters passed to the filter function</span><span class="cm-variable">decoratedSum</span> <span class="cm-operator">=</span> <span class="cm-variable">filterNoNumbersDecorator</span>.<span class="cm-property">decorate</span>(<span class="cm-variable">decoratedSum</span>);<span class="cm-variable">decoratedSum</span> <span class="cm-operator">=</span> <span class="cm-variable">roundDecorator</span>.<span class="cm-property">decorate</span>(<span class="cm-variable">decoratedSum</span>, <span class="cm-number">2</span>); <span class="cm-comment">// rounded to two decimals</span><span class="cm-variable">decoratedSum</span>(<span class="cm-operator">-</span><span class="cm-number">3</span>, <span class="cm-number">1.016</span>, <span class="cm-number">0</span>, <span class="cm-number">4</span>, <span class="cm-atom">NaN</span>, <span class="cm-number">8.041</span>, <span class="cm-string">'27'</span>, <span class="cm-number">9</span>, <span class="cm-number">12</span>); <span class="cm-comment">// "22.06"</span></code></pre><h2 id="good-luck">Good luck!</h2><h2 id="do-not-forget-to-vote-this-kata-if-you-liked">Do not forget to vote this kata if you liked!</h2>